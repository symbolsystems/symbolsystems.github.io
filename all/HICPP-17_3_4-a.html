<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Do not create smart pointers of array type [HICPP-17_3_4-a]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Do not create smart pointers of array type [HICPP-17_3_4-a-3]
</STRONG>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>

"Memory allocated with array new must be deallocated with array delete. A smart
pointer that refers to an array object must have this information passed in when
the object is created. Consequently, you can not construct such a smart pointer
using std::make_shared.

A std::array or std::vector can be used in place of the raw array type. The
usage and performance will be very similar, but will avoid the additional
complexity required when deallocating the array object."
[HIC++ v4.0, Rule 17.3.4]



</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>

v10.4



</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

This rule improves the versatility and usefulness of allocated memory. It also
improves code clarity, quality, and security.



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

#include &lt;cstdint&gt;
#include &lt;memory&gt;

void foo() {
    std::unique_ptr&lt;int32_t[]&gt; oa_1(new int32_t[10]); // Violation
    std::shared_ptr&lt;int32_t&gt; ob_1(
        new int32_t[10],
        std::default_delete&lt;int32_t[]&gt;()); // Violation
}



</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

#include &lt;array&gt;
#include &lt;cstdint&gt;
#include &lt;memory&gt;
#include &lt;vector&gt;

typedef std::vector&lt;int32_t&gt; int_seq;

void foo() {
    std::array&lt;int32_t, 10&gt; oa_2; // OK
    std::shared_ptr&lt;int_seq&gt; ob_2(
        std::make_shared&lt;int_seq&gt;(10, int32_t())); // OK
}



</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

1. High Integrity C++ Coding Standard
   17.3.4. Do not create smart pointers of array type

</PRE>
</BODY>
</HTML>
