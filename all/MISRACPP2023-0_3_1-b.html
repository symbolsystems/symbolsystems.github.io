<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Floating-point expressions shall not be explicitly (syntactically) tested for equality (==) or inequality (!=) [MISRACPP2023-0_3_1-b]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Floating-point expressions shall not be explicitly (syntactically) tested for equality (==) or inequality (!=) [MISRACPP2023-0_3_1-b-4]
</STRONG>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>

"The inherent nature of floating-point types is such that comparisons
of equality will often not evaluate to true even when they are expected to.
In addition the behaviour of such a comparison cannot be predicted before
execution, and may well vary from one implementation to another."
[MISRA C:2012 Amendment 3]

This rule detects when a floating-point expression is used as the operand
of the equality (==) or inequality (!=) operator.



</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>

2022.2



</PRE>
<STRONG>
NOTES
</STRONG>
<PRE>

"Deterministic floating-point comparisons should take into account
the floating-point granularity (FLT_EPSILON) and the magnitude
of the numbers being compared." [MISRA C:2012 Amendment 3]



</PRE>
<STRONG>
EXCEPTIONS
</STRONG>
<PRE>

"Comparison of essentially real floating or essentially complex floating
expressions with the constant literal value of zero or the macro INFINITY
or -INFINITY is permitted." [MISRA C:2012 Rule 10.1 with Amendment 4]

This rule assumes that:
- 'zero' is a floating-point constant with the '0.0' value.
- 'INFINITY' is an identifier with the name 'INFINITY' (usually
   a macro from the 'math.h' standard header)



</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

This rule helps you avoid unexpected behavior.



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

void foo(float fp, double dp)
{
    float fv1 = 0.1f;

    if( fp == fv1 ) {             // Violation
        //...
    }

    if( dp != 0.1 ) {             // Violation
        //...
    }
}



</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

#include &lt;math.h&gt;

void foo( float fp, double dp ) {

    if( fp == 0.0f ) {            // OK - Exception
        //...
    }

    if( dp != INFINITY ) {        // OK - Exception
        //...
    }
}



</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

1. MISRA C++:2023 Guidelines for the use of C++17 in critical systems
   Dir 0.3.1 Floating-point arithmetic should be used appropriately

2. MISRA C:2012 Amendment 3 Updates for ISO/IEC 9899:2011/2018
   Phase 2 - New C11/C18 Features
   2.3 Section 8 - Rules, 2.3.7 Rule 10.1

3. MISRA C:2012 Amendment 4 Updates for ISO/IEC 9899:2011/2018
   Phase 3 - Multi-threading and atomics
   2.2 Section 8 - Rules, 3.1.7 Rule 10.1

</PRE>
</BODY>
</HTML>
