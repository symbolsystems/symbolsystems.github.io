<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Do not use more than one volatile in one expression [MISRA2012-RULE-1_3_k]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Do not use more than one volatile in one expression [MISRA2012-RULE-1_3_k-2]
</STRONG>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>

"The volatile type qualifier is provided in C to denote objects whose value can
change independently of the execution of the program (for example an input
register). If an object of volatile qualified type is accessed this may change
its value. C compilers will not optimise out reads of a volatile. In addition,
as far as a C program is concerned, a read of a volatile has a side effect
(changing the value of the volatile). It will usually be necessary to access
volatile data as part of an expression, which then means there may be dependence
on order of evaluation. Where possible though it is recommended that volatiles
only be accessed in simple assignment statements." [MISRA-C:2004]

"Between any two adjacent sequence points:
(. . .)
3. There shall be no more than one modification access with volatile-qualified
   or atomic type;
4. There shall be no more than one read access with volatile-qualified type."
[MISRA C:2012 Amendment 4]

"Sequence points are summarized in Annex C of both the C90 and C99 standards.
The sequence points in C90 are a subset of those in C99." [MISRA C:2012]

This rule detects when there is more than one modification access or more than
one read access to the volatile-qualified type between two sequence points.

See also: MISRA2004-12_2_b



</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>

v7.0



</PRE>
<STRONG>
NOTES
</STRONG>
<PRE>

The rule does not trigger if access to more than one volatile-qualified type
is used in the function call.
This case is detected by MISRA2004-12_2_b.
    void goo(int, int);
    void foo()
    {
        volatile int v;
        goo(v, v);  // Violation - MISRA2004-12_2_b
    }



</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

This rule helps you ensure that expressions are written in a manner that
consistently produces the same value.



</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

int foo1( volatile int x1,  volatile int x2) {
    return x1 * x2;                           // Violation
}
int foo2( volatile int x1) {
    volatile int x2;
    x2 = x1++ + 1;                            // Violation
    return x2;
}



</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

int foo1( volatile int x1,  volatile int x2) {
    int y1 = x1;
    int y2 = x2;
    return y1 * y2;                           // OK
}
int foo2( volatile int x1) {
    volatile int x2;
    x1++;
    x2 = x1 + 1;                              // OK
    return x2;
}



</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

1.  AUTOSAR C++14 Coding Guidelines
    A5-0-1. The value of an expression shall be the same under any order of
    evaluation that the standard permits

2.  High Integrity C++ Coding Standard
    5.1.2. Do not rely on the sequence of evaluation within an expression

3.  ISO/IEC 9899:1999 Programming languages -- C
    Annex C: Sequence points

4.  JOINT STRIKE FIGHTER, AIR VEHICLE, C++ CODING STANDARDS
    Chapter 4.25 Expressions, AV Rule 204.1

5.  MISRA C++:2008 - Guidelines for the use of the C++ language in critical
    systems, Chapter 6, Section 5, Rule 5-0-1

6.  MISRA C++:2023 Guidelines for the use of C++17 in critical systems
    Rule 4.6.1 Operations on a memory location shall be sequenced appropriately

7.  MISRA C:2012 Amendment 4 Updates for ISO/IEC 9899:2011/2018
    Phase 3 - Multi-threading and atomics
    2.2 Section 8 - Rules, 2.2.9 Rule 13.2

8.  MISRA C:2012 Guidelines for the use of the C language in critical systems
    Section 8: Rules, Rule 1.3

9.  MISRA C:2012 Guidelines for the use of the C language in critical systems
    Section 8: Rules, Rule 13.2

10. MISRA-C:2004 Guidelines for the use of the C language in critical systems
    Chapter 6, Section 12

11. Origin: Misra Guidelines - Rule 46

</PRE>
</BODY>
</HTML>
