<HTML>
<HEAD>
<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<LINK REL="stylesheet" HREF="book.css" TYPE="text/css">
<TITLE>
Avoid code duplication [CDD-DUPC]
</TITLE>
</HEAD>
<BODY BGCOLOR=#FFFFFF>
<STRONG>
Avoid code duplication [CDD-DUPC-3]
</STRONG>
<BR><BR>
<STRONG>
DESCRIPTION
</STRONG>
<PRE>
This rule identifies duplicated code. The rule finds duplicated fragments across 
all tested code, whether or not the duplicated code appears in the same file.

Code duplication detection is focused on giving most useful results 
so the performed analysis is not just simple text tokens compare. 
Additional parameters which can be set for this rule can override compare result 
for different node types.   
Start and end position of code duplication block is calculated using several
internal rules, like:  
- start point can be placed only on statement beginning
- end point can be placed only on statement end
- end point can't leave start point scope (duplicated code block for example, can't start 
  in the middle of one function body and ends in different one)

For example:

@int foo(int a, int b)
{
    @int r;%
    @if (a &lt; b) { 
        @r = b - a;%
    } else {       
        @r = a - b;%
    }         
    @return r;%
}

@ - marks possible start points for duplicated code part 
% - marks possible end points for duplicated code part
 
A violation is reported for each occurrence.
See also: CDD-DUPM


</PRE>
<STRONG>
SINCE
</STRONG>
<PRE>
v9.2


</PRE>
<STRONG>
PARAMETERS
</STRONG>
<PRE>

This rule can be parameterized to achieve best results. 

* Minimal number of duplicated tokens (default value is 80) 
  This parameter value defines minimum size of code fragment which may be reported 
  by this rule.
  Variable names, string and numeric literals, keywords, operators are count as one token.   
  For example:
   
  if (param1 == 0) {   // 7 tokens
      return a;        // 3 tokens
  }                    // 1 token

"Ignore ..." parameters allows some differences to be ignored 
and reported as duplicated code:    

* Ignore string literals (default is off) 
  Turn it on to ignore string literals differences
     
* Ignore number literals (default is off) 
  Turn it on to ignore number literals differences
       
* Ignore boolean literals (default is off) 
  Turn it on to ignore boolean literals differences
     
* Ignore identifiers (local/global variables, function names, ...) (default is off) 
  Turn it on to ignore identifiers differences   

"Report code duplicate found" parameter allows to change scope of duplicated code findings:

* Anywhere in the test scope (default)
  All code duplicates in the test scope are reported

* In the same project
  Only code duplicates located in the same project are reported
  
* In the same file
  Only code duplicates located in the same file are reported 
  

</PRE>
<STRONG>
BENEFITS
</STRONG>
<PRE>

Rule improves readability and maintainability. Simplifies and reduce code size.
Copying and pasting code will increase the cost of code maintenance because 
each time a modification is required, multiple instance of the same code 
will need to be identified and then modified. Reducing or eliminating the amount 
of duplicated code can prevent this problem.


</PRE>
<STRONG>
EXAMPLE
</STRONG>
<PRE>

Parameters: Ignore identifiers turned on, minimum duplicated tokens size set to 20.

int foo(int a, int b)
{
    int r;
    if (a &lt; b) {      // duplicated code
        r = b - a;    // duplicated code
    } else {          // duplicated code
        r = a - b;    // duplicated code
    }                 // duplicated code
    return r;
}

int bar(int p, int q, bool v)
{
    int result;
    if (v) {
        if (p &lt; q) {           // duplicated code
            result = q - p;    // duplicated code
        } else {               // duplicated code
            result = p - q;    // duplicated code
        }                      // duplicated code
    } else {
        return p + q;
    }
    return result;
}


</PRE>
<STRONG>
REPAIR
</STRONG>
<PRE>

int foo(int a, int b)
{
    int r;
    if (a &lt; b) {      
        r = b - a;  
    } else {          
        r = a - b;    
    }                 
    return r;
}

int bar(int p, int q, bool v)
{
    int result;
    if (v) {
        result = foo(p, q);   // use foo function here
    } else {
        result =  p + q;
    }
    return result;
}


</PRE>
<STRONG>
REFERENCES
</STRONG>
<PRE>

N/A

</PRE>
</BODY>
</HTML>
